<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tu Lecci√≥n | Hugo Alvigini</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <style>
    body { font-family: 'Open Sans', sans-serif; margin: 0; padding: 0; background: #f8fafc; color: #1e293b; }
    .container { max-width: 1000px; margin: 0 auto; padding: 2rem 1.5rem; }
    .header-nav { display: flex; justify-content: space-between; margin-bottom: 2rem; }
    .back-link { text-decoration: none; color: #3b82f6; font-weight: 700; }
    .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; border-radius: 20px; overflow: hidden; background: #000; box-shadow: 0 20px 50px rgba(0,0,0,0.1); }
    .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
    .lesson-info { background: white; padding: 2rem; border-radius: 20px; margin-top: 2rem; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
    
    /* üì≤ BURBUJA SOLO PARA CURSOS (Aqu√≠ s√≠ es necesaria) */
    .whatsapp-bubble { 
      position: fixed; bottom: 25px; right: 25px; width: 65px; height: 65px; 
      background-color: #25D366; border-radius: 50%; display: flex; 
      justify-content: center; align-items: center; z-index: 1000; border: 3px solid white; 
      box-shadow: 0 10px 25px rgba(0,0,0,0.2); text-decoration: none;
    }
  </style>
</head>
<body>
  <div id="loader" style="text-align:center; margin-top:100px;">Cargando...</div>
  <div class="container" id="mainContent" style="display:none;">
    <nav class="header-nav"><a href="dashboard.html" class="back-link">‚Üê Volver</a></nav>
    <div class="video-wrapper" id="videoContainer"></div>
    <div class="lesson-info"><h1 id="lessonTitle"></h1><p id="lessonDesc"></p></div>
  </div>

  <a id="waLink" href="#" class="whatsapp-bubble" target="_blank" rel="noopener" aria-label="Consultar sobre otros cursos">
    <i class="fab fa-whatsapp" style="color: white; font-size: 32px;"></i>
  </a>

  <script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyLOXOGA8rMYKyxGrYPNtDo7ZFUlUeQjDRAgrfhSJk2p44pzzHdtx-ZQ9U7JW0bd5wJvQ/exec";
    const userEmail = localStorage.getItem('userEmail');
    const userToken = localStorage.getItem('userToken');
    const cursoId = localStorage.getItem('cursoActual');
    const userName = localStorage.getItem('userName') || 'Emprendedor';

    async function cargarLeccion() {
        if (!userEmail || !cursoId) { window.location.href = "index.html"; return; }
        try {
            const res = await fetch(`${WEB_APP_URL}?action=getCurso&id=${cursoId}&email=${userEmail}&token=${userToken}`);
            const data = await res.json();
            if (data.status === "success") {
                document.getElementById('loader').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                document.getElementById('lessonTitle').innerText = data.nombre;
                document.getElementById('lessonDesc').innerText = data.descripcion || "";
                if(data.urlVideo) document.getElementById('videoContainer').innerHTML = `<iframe src="${data.urlVideo}" allowfullscreen></iframe>`;
                
                // üöÄ Mensaje de Escalabilidad
                const msg = `Hola Hugo! Soy ${userName} (${userEmail}), te escribo desde mi curso porque me interesa subir mi nivel y conocer qu√© otros cursos tienes para escalar mi negocio.`;
                document.getElementById('waLink').href = `https://wa.me/5491136151754?text=${encodeURIComponent(msg)}`;
            } else { alert("Acceso denegado. Reingresa al sistema."); window.location.href = "index.html"; }
        } catch (e) { document.getElementById('loader').innerText = "Error de red. Intenta de nuevo."; }
    }
    cargarLeccion();
  </script>
</body>
</html>
