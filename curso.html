<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lecciones | Hugo Alvigini</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { font-family: 'Open Sans', sans-serif; margin: 0; background: #f1f5f9; color: #1e293b; }
    .nav-bar { background: #1e3c72; color: white; padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    .content-area { max-width: 900px; margin: 30px auto; padding: 0 20px; }
    .lesson-card { background: white; border-radius: 15px; padding: 25px; margin-bottom: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; }
    .btn-play { background: #1e3c72; color: white; padding: 10px 25px; border-radius: 10px; text-decoration: none; font-weight: bold; cursor: pointer; border: none; }
    .video-modal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); display:none; justify-content:center; align-items:center; z-index:2000; }
    iframe { width: 85%; height: 80%; border-radius: 20px; border: 4px solid white; }
  </style>
</head>
<body>
  <header class="nav-bar">
    <h2 id="courseTitle">Cargando...</h2>
    <button onclick="history.back()" style="background:rgba(255,255,255,0.2); color:white; border:none; padding:10px 20px; border-radius:10px; cursor:pointer;">Volver</button>
  </header>

  <div class="content-area" id="lessonContainer">
     <div style="text-align:center; padding:100px"><i class="fas fa-circle-notch fa-spin fa-3x" style="color:#1e3c72"></i></div>
  </div>

  <div id="videoModal" class="video-modal" onclick="cerrarVideo()">
     <iframe id="videoIframe" src="" frameborder="0" allowfullscreen></iframe>
  </div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycby0d3lmpWy_JKb-JObmsi8yL71alS_EfELD_bm63irK2U-Mxm1V4u_KkvlkprNt96ZO/exec";
    const params = new URLSearchParams(window.location.search);
    const cursoId = params.get('cursoId');
    const sessionId = params.get('sessionId');

    async function cargarLecciones() {
      const res = await fetch(`${API_URL}?action=getCourse&cursoId=${cursoId}&sessionId=${sessionId}`);
      const data = await res.json();
      
      document.getElementById('courseTitle').innerText = cursoId.toUpperCase();
      const container = document.getElementById('lessonContainer');
      container.innerHTML = "";

      for (let mod in data.curso.modulos) {
        let modHtml = `<h2 style="margin-top:40px; color:#1e3c72; border-bottom:3px solid #30D5C8; padding-bottom:10px">${mod}</h2>`;
        data.curso.modulos[mod].forEach(leccion => {
          if(leccion.tipo === 'leccion') {
            modHtml += `
              <div class="lesson-card">
                <div>
                  <h3 style="margin:0">Lecci√≥n ${leccion.id}: ${leccion.titulo}</h3>
                  <p style="color:#64748b; font-size:0.9em; margin:5px 0 0">${leccion.descripcion || ''}</p>
                </div>
                ${leccion.video.url ? `<button class="btn-play" onclick="verVideo('${leccion.video.url}')"><i class="fas fa-play"></i> Ver</button>` : ''}
              </div>`;
          }
        });
        container.innerHTML += modHtml;
      }
    }

    function verVideo(url) {
      const iframe = document.getElementById('videoIframe');
      iframe.src = url.replace('/view?usp=sharing', '/preview');
      document.getElementById('videoModal').style.display = 'flex';
    }

    function cerrarVideo() {
      document.getElementById('videoIframe').src = "";
      document.getElementById('videoModal').style.display = 'none';
    }

    window.onload = cargarLecciones;
  </script>
</body>
</html>
